# https://aka.ms/yaml

name: $(SourceBranchName)-PR-$(Date:yyyy-MM-dd)$(Rev:.r)

parameters:
  - name: Branch
    type: string

trigger: none

pool:
  vmImage: windows-latest

jobs:
- job: Build
  displayName: 'Build PowerShell module'
  variables:
    Branch: ${{ parameters.Branch }}
  steps:
  - task: powershell@2
    displayName: 'Show current PowerShell version information'
    inputs:
      targetType: inline
      script: 'echo $PSVersionTable'
      pwsh: false
  - task: powershell@2
    displayName: 'Install AzureAD'
    inputs:
      targetType: inline
      script: Install-Module AzureAD
      pwsh: false
      
  - task: powershell@2
    displayName: 'Install Microsoft Graph SDK'
    inputs:
      targetType: inline
      pwsh: false
      script: |
      Install-Module Microsoft.Graph.Users
      Install-Module Microsoft.Graph.Users.Actions
      Install-Module Microsoft.Graph.Users.Functions
      Install-Module Microsoft.Graph.Groups
      Install-Module Microsoft.Graph.Identity.DirectoryManagement
      Install-Module Microsoft.Graph.Identity.Governance
      Install-Module Microsoft.Graph.Identity.SignIns
      Install-Module Microsoft.Graph.Applications

  - task: powershell@2
    displayName: 'Build'
    inputs:
      targetType: inline
      script: ./build/Create-CompatModule.ps1
      pwsh: false